<%INIT>
my $version = $r->headers_in->{'X-Ticket-Sharing-Version'};
if ( $version || $version ne '1' ) {
    return RT::Extension::NHD->BadWebRequest('Precondition Failed');
}

my $ct = $r->content_type;
my $method = uc $r->method;

my $data;
if ( $method ne 'GET' && (!$ct || $ct =~ m{^text/x-json}) ) {
    $data = RT::Extension::NHD->FromJSON( $r->content );
    return RT::Extension::NHD->BadWebRequest unless $data;
}

$m->call_next( %$data );

</%INIT>
